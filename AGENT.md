# 🤖 Agent Guidelines: 꿀통(Honey Pot) 프로젝트

## 1. 프로젝트 개요

**꿀통(Honey Pot)**은 **보험 전문 AI 챗봇 어시스턴트 서비스**입니다. 사용자가 자신의 보험에 대해 궁금한 점을 질문하면, RAG(Retrieval-Augmented Generation) 기술을 활용하여 정확하고 유용한 답변을 제공하는 것을 목표로 합니다.

- **주요 기술 스택**:
  - **Backend**: FastAPI (Python)
  - **Frontend**: Next.js (TypeScript)
  - **Database**: PostgreSQL (구조화된 데이터), Vector DB (비정형 문서)
  - **Infrastructure**: Docker Compose

## 2. 핵심 아키텍처 및 데이터 흐름

1.  **사용자 질문 접수**:
    * 모든 사용자 채팅 메시지는 백엔드의 **`chat/ask`** 엔드포인트로 전송됩니다.

2.  **의도 분류 (Mode Classification)**:
    * 1차 LLM이 사용자 질문의 의도를 분석하여 5가지 `Mode` 중 하나로 분류합니다.
        - `TERMS`: 보험 약관 분석
        - `REFUND`: 환급금 안내
        - `RECOMMEND`: 보험 추천
        - `GENERAL`: 일반 질문
        - `FALLBACK`: 보험과 무관하거나 모호한 질문

3.  **RAG 및 답변 생성 (Core Logic)**:
    * 분류된 `Mode`에 따라 **`retriever.py`** 스크립트가 핵심적인 RAG 프로세스를 수행합니다.
    * **Context 추출**: Vector DB와 PostgreSQL에서 사용자의 질문과 관련된 문서, 데이터, 요약 정보를 가져옵니다.
    * **LLM 호출 및 정제**: 추출된 Context를 바탕으로 2차 LLM(메인 모델)이 최종 답변을 생성하고, 이 답변이 사용자에게 전달됩니다.

## 3. 핵심 기능 (3가지 주요 채팅 기능)

사용자의 질문 의도를 파악하여 아래 3가지 주요 기능 중 하나를 수행합니다. 답변 생성 시 **Vector DB**의 문서와 **PostgreSQL**의 요약 정보를 기반으로 RAG를 활용합니다.

1.  **환급금 안내**: 특정 질병 코드나 진단 내역에 대해 사용자가 받을 수 있는 예상 환급금을 계산하고 안내합니다.
2.  **보험 추천**: 사용자의 상황(기존 보험, 연령, 필요 등)을 분석하여 최적의 보험 상품을 추천합니다.
3.  **보험 약관 분석**: 사용자가 가입했거나 궁금해하는 보험의 복잡한 약관을 쉽게 풀어서 설명합니다.

## 4. 추가 개발 기능 (사이드 기능)

현재 논의 중이거나 일부 구현이 필요한 기능들입니다.

### 가. 기간 임박 청구 팝업 기능

-   **목표**: 사용자가 놓칠 수 있는 보험금 청구 건을 마감 기한 전에 알려주는 기능.
-   **동작 방식**:
    1.  **데이터 수집**: `REFUND`(환급금 조회) 타입의 채팅 내역을 스케줄러가 주기적으로 분석합니다.
    2.  **타임라인 생성**: 채팅 내용에서 **질병명, 보험명, 기산일(사고일), 예상 환급액**을 추출하여 `claim_timeline` 테이블에 기록합니다. (보험금 청구 기한은 통상 기산일로부터 3년)
    3.  **알림 예약**: `notifications` 테이블에 마감일 기준(예: 60일 전)으로 알림을 예약합니다.
    4.  **팝업 노출**: 사용자가 로그인할 때, 프론트엔드에서 `deliver_due_notifications` API를 호출합니다. 마감 임박 건이 있으면, 총 예상 환급액과 남은 기간을 팝업으로 보여줍니다.
-   **주요 컴포넌트**:
    -   `extractor.py`: 채팅에서 날짜 등 핵심 정보를 추출합니다. (향후 LLM+RAG로 고도화)
    -   `scheduler.py`: `APScheduler`를 사용하여 매일 09:00에 `scan_and_build_timeline()`을 실행합니다.

### 나. 환급 통합 자동청구 기능

-   **목표**: 채팅으로 확인된 여러 환급 건을 모아 자동으로 청구를 진행하는 기능.
-   **동작 방식**:
    1.  환급금 조회 채팅 내역을 분석하여 청구 가능한 보험사와 금액을 정리합니다.
    2.  사용자에게 총 환급 가능 금액과 내역을 보여주고, 동의 시 자동 청구 프로세스를 진행합니다.

### 다. 보험 심사 내역 분석기

-   **목표**: 사용자가 업로드한 보험 심사 내역서의 문제점을 분석하고 알려주는 기능.
-   **동작 방식**:
    1.  사용자가 보험 심사 내역 문서를 업로드합니다.
    2.  AI가 해당 문서를 사용자의 보험 약관/보장 내용과 비교 분석하여 심사가 올바르게 이루어졌는지, 부당한 부분은 없는지 판단하여 결과를 제공합니다.

## 5. 주요 요청사항

저(코딩 파트너)에게는 주로 아래와 같은 코드 수정 및 개발 요청을 하실 예정입니다.

-   **FastAPI (Backend)**: API 엔드포인트 추가/수정, 데이터베이스 모델링, 비즈니스 로직 구현 등
-   **Next.js (Frontend)**: UI 컴포넌트 개발, API 연동, 상태 관리 등